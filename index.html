<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Docker從入門到入迷</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <style>
        .reveal .fa {
            font-family: 'FontAwesome';
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/vs.min.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">
    <!--Add support for earlier versions of Internet Explorer -->
    <!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>
    <!-- Wrap the entire slide show in a div using the "reveal" class. -->
    <div class="reveal">
        <!-- Wrap all slides in a single "slides" class -->
        <div class="slides">

            <!-- ALL SLIDES GO HERE -->
            <!-- Each section element contains an individual slide -->
            <section>
                <h1>Docker 從入門到入迷</h1>
            </section>
            <section>
                <h1>
                    <del>Docker 從入門到入魔&#x1f608;</del>
                </h1>
                <p>之魔鬼藏在細節裡</p>
            </section>
            <section>
                <section>
                    <h1>這裡會講到</h1>
                    <h3>
                        <ul>
                            <li>Docker</li>
                            <li>Docker Compose</li>
                        </ul>
                    </h3>
                </section>
                <section>
                    <h1>不會講到</h1>
                    <h3>
                        <ul style="text-align: center;">
                            <li style="text-align: left">Kubernates<br/><span>
                            <a style="text-transform: lowercase;" href="http://kubernetes.io" target="_blank">http://kubernetes.io</a></span></li>
                            <li style="text-align: left">Mesos<br/><span>
                                <a style="text-transform: lowercase;" href="http://mesos.apache.org" target="_blank">http://mesos.apache.org</a></span></li>
                        </ul>
                    </h3>
                    <p>以及其他很複雜但除範例之外<br/>不知道怎麼跑起來的方案&#x1f60f;</p>
                </section>
            </section>
            <section>
                <section>
                    <p>大家都說<b style="font-size:200%">容器化</b>是未來趨勢...</p>
                </section>
                <section>
                    <p>但我們只有一堆Copy & Paste的Server端<b style="font-size:200%">舊程式</b>...</p>
                </section>
                <section>
                    <p>要用怎樣的方法來最小幅度<b style="font-size:200%">改造</b>舊程式， 以便能夠用
                        <b><a href="https://github.com/docker/docker" target="_blank">Docker</a></b> + <b><a href="https://github.com/docker/compose" target="_blank">Docker Compose</a></b>的組合，
                        配合內部架設
                        <b><a href="https://github.com/docker/distribution" target="_blank">Docker庫</a></b>來做開發時期的維護及營運時期的運行。</p>
                </section>
            </section>
            <section>
                <section>
                    <p>首先來說為何要<b style="font-size:150%">容器化</b>...</p>
                </section>
                <section>
                    <img data-src="./pic/game_DAU.jpg" />
                    <small class="caption">
                        來源：<a href="http://blog.gameanalytics.com/blog/what-analysing-400-games-taught-us.html" target="_blank">http://blog.gameanalytics.com/blog/what-analysing-400-games-taught-us.html</a>
                    </small>
                    <p class="fragment fade-up" style="font-size:120%">從正式上線營運開始後三星期到一個月之間是<br/>關鍵<span style="font-size:120%">&#x1f4b0;</span>觀察期</p>
                </section>
                <section>
                    <h2>
                        流量特性：
                    </h2>
                    <h3>
                        <ul style="margin: 0px">
                            <li class="fragment fade-up" data-fragment-index="1">
                                <div style="white-space: nowrap;">一開始會有暴衝流量(衝首發)</div>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="2">
                                <div style="white-space: nowrap;">如果紅了還會繼續暴衝(病毒式傳播)</div>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="3">
                                <div style="white-space: nowrap;">如果不紅就會掉得很快(該撤收了)</div>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="4">
                                <div style="white-space: nowrap;">真的不紅主動減少維護人力硬體等開銷</div><small class="fragment fade-up" data-fragment-index="5">(自動營運)</small>
                            </li>
                        </ul>
                    </h3>
                    <h3 class="fragment fade-up" data-fragment-index="6">如何根據實際情況有效配置硬體資源讓營運成本降低？</h3>
                </section>
                <section>
                    <h1>
                        讓伺服器配置有彈性
                    </h1>
                    <h3>
                        <ul>
                            <li class="fragment fade-up">
                                <div style="white-space: nowrap;">安裝佈署的方法要很容易&自動化</div>
                            </li>
                            <li class="fragment fade-up">
                                <div style="white-space: nowrap;">遷移到更↑或↓配置的硬體流程簡易&快</div>
                            </li>
                            <li class="fragment fade-up"><br/>
                                <div style="white-space: nowrap;">
                                    <del style="font-weight: lighter">最好還不用多花錢&#x1f4b8;
                                        <del>
                                </div>
                            </li>
                        </ul>
                    </h3>
                </section>
                <section>
                    <h2>
                        Game Table
                    </h2>
                    <h3>
                        <ul>
                            <li class="fragment fade-up" data-fragment-index="1">遊戲系統中佔很大部分的設定檔</li>
                            <li class="fragment fade-up" data-fragment-index="2">遊戲商業邏輯的核心資料</li>
                            <li class="fragment fade-up" data-fragment-index="3">至少一半bug是這類資料沒設定正確導致</li>
                            <li class="fragment fade-up" data-fragment-index="4">要有辦法能在發現錯誤之後快速回溯上個版本重新佈署
                                <small class="fragment fade-up" data-fragment-index="5">(退版)</small></li>
                        </ul>
                    </h3>
                </section>
                <section>
                    <h1>使用Docker做容器化</h1>
                    <ul>
                        <li>Ops:
                            <ul>
                                <li class="fragment fade-up" data-fragment-index="1">伺服器的部署方法完全一致統一化</li>
                                <li class="fragment fade-up" data-fragment-index="2">多個服務要(縮減規模)同時部署在單台硬體上較簡單
                                    <div class="fragment fade-up" data-fragment-index="3">(port mapping且容器內的程式不需改設定)</div>
                                </li>
                                <li class="fragment fade-up" data-fragment-index="4">萬一要退版，藉由Docker的
                                    <a href="https://docs.docker.com/v1.5/terms/layer/#union-file-system" target="_blank">Union File System</a>                                    特性可快速退回先前的狀態來回溯服務狀態
                                </li>
                            </ul>
                        </li>
                        <li>Dev:
                            <ul>
                                <li class="fragment fade-up" data-fragment-index="5"><span style="white-space: nowrap;">開發環境≒營運環境</span>，而且不用花時間自己安裝</li>

                                <li class="fragment fade-up" data-fragment-index="6">不怕過了很久以後要修改程式碼找不到舊版本函式庫&套件工具</li>
                            </ul>
                        </li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>Docker<br/>(docker-engine)<br/>是什麼</h2>
                    <div>
                        <ul>
                            <li class="fragment fade-up" data-fragment-index="1">
                                <span style="white-space: nowrap;">Light Weight VM<i class="fa fa-question" aria-hidden="true"></span></i><br/>
                                <span style="font-size:80%" class="fragment fade-up" data-fragment-index="2">
                                <a href="http://blog.docker.com/2016/03/containers-are-not-vms/" target="_blank">Containers&nbsp;are&nbsp;not&nbsp;VMs</a></span>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="3">
                                <span style="white-space: nowrap;">Runtime<i class="fa fa-question" aria-hidden="true"></i></span>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="4">
                                <span style="white-space: nowrap;">Sandbox<i class="fa fa-question" aria-hidden="true"></i></span>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="5">
                                <span style="white-space: nowrap;">Transport Package Format<i class="fa fa-question" aria-hidden="true"></i></span>
                            </li>
                        </ul>
                    </div>
                    <div style="display: block; position: absolute; top: 0px; left: 0px; width:100%; height: 100%;pointer-events: none;" class="fragment fade-up"
                        data-fragment-index="6">
                        <div style="pointer-events: none;" class="fragment fade-out" data-fragment-index="7">
                            <img style="width: 100%;height: 100%;pointer-events: none;" data-src="./pic/ElephantBlindmen.png" />
                        </div>
                    </div>
                </section>
                <section>
                    <h2>Docker<br/>(docker-engine)<br/>是什麼</h2>
                    <h3 class="fragment fade-up" data-fragment-index="1">不管它是什麼，要做的就是：</h3>
                    <ol>
                        <li class="fragment fade-up" data-fragment-index="2">
                            <div style="white-space: nowrap;">將應用程式&執行環境進行<b>包裝</b>產生可佈署的『image』</div>
                        </li>
                        <li class="fragment fade-up" data-fragment-index="3">
                            <div style="white-space: nowrap;">『image』藉由一些步驟導入到目標端機器的docker上</div>
                        </li>
                        <li class="fragment fade-up" data-fragment-index="4">
                            <div style="white-space: nowrap;">『image』在目標端的docker上啟動執行該應用</div>
                        </li>
                    </ol>
                </section>
                <section>
                    <h3>幾個概念</h3>
                    <div style="display: table; table-layout: fixed; width:100%; overflow:hidden;">
                        <div style="display: table-cell; width: 40%;vertical-align: middle;">
                            <img style="display: block; margin: 0px;" data-src="./pic/engine-components-flow.png" data-action="zoom" /><br/>
                            <small>來源：<a href="https://docs.docker.com/engine/understanding-docker/#/what-is-docker-engine" target="_blank">官網docker-engine</a></small>
                        </div>
                        <div style="display: table-cell; margin-left: 20px; vertical-align: middle; float:right">
                            <ol>
                                <li class="fragment fade-up" data-fragment-index="1">client-server架構</li>
                                <li class="fragment fade-up" data-fragment-index="2"><strong class="fragment highlight-green" data-fragment-index="2">Running Container</strong><small>&nbsp;(run time)</small><br/>
                                    <span class="fragment fade-up" data-fragment-index="3"><small>v.s.&nbsp;</small>
                                        <span/>
                                        <span class="fragment fade-up" data-fragment-index="4"><strong class="fragment highlight-green" data-fragment-index="2">Fixed Image</strong>
                                        <small>(build time)</small></span></li>
                                <li class="fragment fade-up" data-fragment-index="5"><strong>Union File System</strong>分層構造<br/>
                                    <span class="fragment fade-up" data-fragment-index="6">
                                        <small>(for static data & code or exe)</small></span></li>
                                <li class="fragment fade-up" data-fragment-index="7"><strong><a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank">Volume</a></strong>&nbsp;for
                                    state data<br/>
                                    <ul style="font-size: 80%">
                                        <li class="fragment fade-up" data-fragment-index="8">多個容器可以共享單一volume。</li>
                                        <li class="fragment fade-up" data-fragment-index="9">容器volume可以對應到實體機器FS路徑位置。</li>
                                        <li class="fragment fade-up" data-fragment-index="10">image產生時可以定義內部路徑位置的volume，並由另一個容器啟動時mount上去使用。
                                            <br/>(<a href="http://docs.docker.com/engine/reference/run/#/volume-shared-filesystems"
                                                target="_blank">--volumes-from</a>)</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </div>
                </section>
                <section>
                    <h2>Docker Compose<br/>是什麼</h2>
                    <ul>
                        <li class="fragment fade-up" data-fragment-index="1">
                            docker的client端操作單用指令列打命令落落長
                        </li>
                        <li class="fragment fade-up" data-fragment-index="2">運作環境的配置通常不會只有單一個容器</li>
                        <li class="fragment fade-up" data-fragment-index="3">根據執行環境有不同的環境變數&設定檔對應</li>
                    </ul>
                    <div><br/></div>
                    <h4 class="fragment fade-up" data-fragment-index="4">需要有類似Bash Script批次化一堆手工命令操作步驟的工具</h4>
                </section>
                <section>
                    <pre>
                        <code class="hljs yaml">
version: '2'

services:
  <mark>varnish</mark>:
    extends:
      file: docker-compose.base.yml
      service: varnish-base
    env_file:
      - ./conf/varnish-cache/env/web.env
    volumes:
      - ./conf/varnish-cache/vcl:/etc/varnish/
    links:
      - default_site:normal_site
    ports:
      - "80:80"
    networks:
      - back_end

  # application container
  <mark>default_site</mark>:
    extends:
      file: docker-compose.base.yml
      service: nginx-base
    volumes:
      - ./conf/nginx/config:/etc/nginx
    links:
      - phpfpm
    volumes_from:
      - phpfpm
    networks:
      - back_end

  <mark>phpfpm</mark>:
    extends:
      file: docker-compose.base.yml
      service: phpfpm-base
    volumes:
      - ./conf/phpfpm/config:/usr/local/etc
      - ./src/php:/var/www/html
    links:
      - redis0cache
    networks:
      - back_end

  #cache container
  <mark>redis0cache</mark>:
    extends:
      file: docker-compose.base.yml
      service: redis-base
    volumes:
      - ./conf/redis/config:/usr/local/etc/redis
      - ./data/redis:/data
    ports:
      - "6379:6379"
    networks:
      - back_end

networks:
  back_end:
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>使用Docker Compose的優點</h2>
                    <ul>
                        <li class="fragment fade-up" data-fragment-index="1">
                            多容器運作環境的組態用.yaml檔案控制
                            <ol>
                                <li class="fragment fade-up" data-fragment-index="2"><code>Compose Project</code>目錄&namespace的概念</li>
                                <li class="fragment fade-up" data-fragment-index="3">保證多容器的啟動順序不出錯</li>
                                <li class="fragment fade-up" data-fragment-index="4">.yaml檔案所定義的
                                    <a href="http://docs.docker.com/compose/compose-file/#/service-configuration-reference" target="_blank">容器服務(service)</a>可用繼承的概念來擴展</li>
                            </ol>
                        </li>
                        <li class="fragment fade-up" data-fragment-index="5">受控制的多個容器可批次化進行DOCKER指令操作
                            <code class="fragment fade-up" data-fragment-index="6"><a href="http://docs.docker.com/compose/reference/pull/" target="_blank">docker-compose pull</a></code>&nbsp;&nbsp;&nbsp;&nbsp;
                            <code class="fragment fade-up" data-fragment-index="7"><a href="http://docs.docker.com/compose/reference/push/" target="_blank">docker-compose push</a></code>
                        </li>
                        <li class="fragment fade-up" data-fragment-index="8">配合執行環境可使用不同設定檔對應<br/>
                            <span class="fragment fade-up" data-fragment-index="9">
                            <a href="https://docs.docker.com/compose/compose-file/#/variable-substitution" target="_blank">Variable Substitution</a>
                            </span>
                        </li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>
                        容器化的步驟
                    </h2>
                </section>
                <section>
                    <h3>
                        既有應用程式docker化的方法：
                    </h3>
                    <ol>
                        <li class="fragment fade-up" data-fragment-index="1">寫dockerfile檔以docker build建立出『image』</li>
                        <li class="fragment fade-up" data-fragment-index="2">寫docker-compose.yml檔配置組態</li>
                        <li class="fragment fade-up" data-fragment-index="3">docker-compose up，打完收工</li>
                    </ol>
                    <p class="fragment fade-up" data-fragment-index="4">
                        <del>這麼簡單piece of cake&#x1f370;?!大家可以去吃點心了?!</del>
                    </p>
                    <h4 class="fragment fade-up" data-fragment-index="5">當然不是！&#x1f613;</h4>
                </section>
                <section>
                    <h3>寫dockerfile檔以docker build建立出『image』</h3>
                    <h4 class="fragment fade-up" data-fragment-index="0">如何分層?</h4>
                    <div style="display: table;width: 100%;">
                        <div style="display: table-cell; vertical-align:center;width: 50%;">
                            <div style="font-style: italic;font-size: 120%; font-weight: bold;white-space: nowrap" class="fragment fade-up" data-fragment-index="1">既有業務流程</div>
                            <ul>
                                <li class="fragment fade-up" data-fragment-index="2">
                                    <div style="white-space: nowrap;">開發技術</div>
                                </li>
                                <li class="fragment fade-up" data-fragment-index="3">
                                    <div style="white-space: nowrap;">商業邏輯</div>
                                </li>
                                <li class="fragment fade-up" data-fragment-index="4">
                                    <div style="white-space: nowrap;">DevOps流程</div>
                                </li>
                            </ul>
                        </div>
                        <div style="display: table-cell; vertical-align:center;width: 50%;">
                            <div style="font-style: italic;font-size: 120%; font-weight: bold;white-space: nowrap" class="fragment fade-up" data-fragment-index="1">容器化技術特性</div>
                            <ul class="fa fa-ul" style="padding-left: 48px;">
                                <li class="fa fragment fade-up" data-fragment-index="5">
                                    <i class="fa fa-li fa-check"></i>
                                    <span style="white-space: nowrap;">單一容器功能要單一</span>
                                </li>
                                <li class="fa fragment fade-up" data-fragment-index="6">
                                    <i class="fa fa-li fa-check"></i>
                                    <span style="white-space: nowrap;">image可多場合reuse</span>
                                </li>
                                <li class="fa fragment fade-up" data-fragment-index="7">
                                    <i class="fa fa-li fa-check"></i>
                                    <span style="white-space: nowrap;">方便＆快速deploy</span>
                                </li>
                            </ul>
                        </div>
                </section>
                <section id="image-layering">
                    <div style="display: block; position: absolute; top: 0px; left: 0px;">
                        <img style="border: 0px;" data-src="./pic/docker_image_arch.png " /><br/>
                        <p class="fragment fade-out" data-fragment-index="0">Layering...</p>
                    </div>
                    <div style="display: block; position: absolute; top: 0px; left: 0px;" class="fragment current-visible" data-fragment-index="1">
                        <img style="border: 0px;" data-src="./pic/docker_image_arch.png " /><br/>
                        <p>Ops mode</p>
                    </div>
                    <div style="display: block; position: absolute; top: 0px; left: 0px;" class="fragment fade-in" data-fragment-index="2">
                        <img style="border: 0px;" data-src="./pic/docker_image_arch.png " /><br/>
                        <p>Dev mode</p>
                    </div>
                </section>
                <section>
                    <h4>
                        整體流程
                    </h4>
                    <p style="text-align: left;">
                        開發時期:
                        <ol style="font-size: 80%">
                            <li class="fragment fade-up" data-fragment-index="1">
                                根據<a href="http://docs.docker.com/docker-hub/official_repos/" target="_blank">docker hub上提供的官方image</a>切分服務，不夠的再自行根據Base
                                OS image寫<a href="http://docs.docker.com/engine/reference/builder/" target="_blank">Dockerfile</a>自建。
                            </li>
                            <li class="fragment fade-up" data-fragment-index="2">
                                撰寫Dockerfile及<a href="http://docs.docker.com/compose/compose-file/" target="_blank">docker-compose.yml</a>，建出配合舊有應用程式所需的image，設定檔的部分也先用volume
                                mapping的方式餵進去。
                            </li>
                            <li class="fragment fade-up" data-fragment-index="3">
                                使用volume mapping的方式將原本建置流程產生的執行檔直接餵進去讓docker容器使用，進行開發測試。<br/>
                                <small class="fragment fade-up" data-fragment-index="4">（<del>軟體開發動力學第0定律—<b>可以跑就好</b>&#x1F643;</del>）</small>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="5">
                                封裝開發時期產出物：
                                <ul class="fa fa-ul">
                                    <li class="fa fragment fade-up" data-fragment-index="6"><i class="fa fa-li fa-check-square"></i>
                                        <span>
                                        撰寫新Dockerfile繼承自原本開發時期使用的docker image，新增的<a href="https://docs.docker.com/engine/reference/builder/#add" target="_blank">ADD</a>/<a href="https://docs.docker.com/engine/reference/builder/#copy" target="_blank">COPY</a>指令動作將建置成果執行檔加入image。
                                        </span>
                                    </li>
                                    <li class="fa fragment fade-up" data-fragment-index="7"><i class="fa fa-li fa-check-square"></i>
                                        <span>
                                        採用『<a href="https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container" target="_blank">data volume container</a>』的方式把<code>設定檔</code><br/>(不含Game&nbsp;Table資料)封裝產生docker image。
                                        </span>
                                    </li>
                                    <li class="fa fragment fade-up" data-fragment-index="8"><i class="fa fa-li fa-check-square"></i>
                                        <span>
                                        以上兩種docker image要release時記得根據版本號加<a href="http://docs.docker.com/engine/reference/commandline/tag/" target="_blank">tag</a>。
                                        </span>
                                    </li>
                                </ul>
                            </li>
                        </ol>
                    </p>
                </section>
                <section>
                    <h4>
                        整體流程
                    </h4>
                    <p style="text-align: left;">
                        Game Table資料導入＆驗證審核：
                        <ol style="font-size: 80%">
                            <li class="fragment fade-up" data-fragment-index="0">
                                遊戲企劃使用除了Game Table目錄資料由volume mapping導入，其他都是由開發團隊釋出的docker image搭建起來的系統上，實際執行測試遊戲，即時修改及驗證Game Table的資料正確性。<br/>
                                <small class="fragment fade-up" data-fragment-index="1">（<del>所以需要程式內先做<span style="white-space: nowrap;color: black;font-family: 'FontAwesome';font-weight: 900;"><strong>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">↑</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">↑</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">↓</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">↓</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">←</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">→</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-weight: inherit; font-size: 0.85em;">←</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit; font-weight: inherit; font-size: 0.85em;">→</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">B</kbd>
                                    <kbd style="border: 1px solid #aaa; -moz-border-radius: 0.2em; -webkit-border-radius: 0.2em; border-radius: 0.2em; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; background-image: -moz-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -o-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: -webkit-linear-gradient(top, #eee, #f9f9f9, #eee); background-image: linear-gradient(to bottom, #eee, #f9f9f9, #eee); padding: 0.1em 0.3em; font-family: inherit;font-weight: inherit; font-size: 0.85em;">A</kbd></strong>
                                    </span>
                                    <a href="https://en.wikipedia.org/wiki/Konami_Code" target="_blank">Konami Code</a>來加快效率才不會測得太辛苦&#x1F643;</del>）</small>
                            </li>
                            <li class="fragment fade-up" data-fragment-index="2">
                                資料測試無誤後：
                                <ul class="fa fa-ul">
                                    <li class="fa fragment fade-up" data-fragment-index="3"><i class="fa fa-li fa-check-square"></i> 以
                                        <a href="https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container" target="_blank">data volume container</a>的方式將Game
                                        Table資料封裝進
                                        <span style="white-space:nowrap">docker image</span>。
                                    </li>
                                    <li class="fa fragment fade-up" data-fragment-index="4"><i class="fa fa-li fa-check-square"></i> docker image釋出時加<a href="http://docs.docker.com/engine/reference/commandline/tag/"
                                            target="_blank">tag</a>版本號。
                                    </li>
                                </ul>
                            </li>
                        </ol>
                    </p>
                    <hr class="fragment fade-up" data-fragment-index="5" />
                    <p style="font-size:90%" class="fragment fade-up" data-fragment-index="5">
                        <i class="fa fa-check-square"></i>以上所有可發佈<span style="white-space: nowrap;">docker image</span>都會push到內部Docker庫準備deploy</p>
                </section>
                <section>
                    <h4>
                        整體流程
                    </h4>
                    <p style="text-align: left;">
                        運營時期：
                        <ol style="font-size: 80%">
                            <li class="fragment fade-up" data-fragment-index="1">
                                運營環境的Linux伺服器上有設定環境變數，對應docker image正確配置的版本號tag。
                            </li>
                            <li class="fragment fade-up" data-fragment-index="2">
                                營運人員由docker-compose.yml檔執行<code>docker-compose pull</code>把對應tag版本的docker image下載到伺服器上。
                            </li>
                            <li class="fragment fade-up" data-fragment-index="3">
                                執行<code>docker-compose up</code>，啟動服務。
                            </li>
                        </ol>
                    </p>
                    <hr class="fragment fade-up" data-fragment-index="5" />
                    <p style="font-size:75%">
                        <ul style="font-size: 80%" class="fa fa-ul">
                            <li class="fa fragment fade-up" data-fragment-index="6">
                                <i class="fa fa-li fa-check-square"></i>要進版/退版:修改環境變數後再<code>docker-compose pull</code>抓取對應版本啟動服務應用。
                            </li>
                            <li class="fa fragment fade-up" data-fragment-index="7">
                                <i class="fa fa-li fa-check-square"></i>實際使用時配合寫好的shell script執行，在script內預先備份/建立好啟動時需要的docker
                                volume。
                            </li>
                            <li class="fa fragment fade-up" data-fragment-index="8">
                                <i class="fa fa-li fa-check-square"></i>甚至容器執行需要的設定檔、docker-compose的yml檔都是塞進一個專用docker image，運營人員pull/start該image以便取出使用。
                            </li>
                        </ul>
                    </p>
                </section>
                <section>
                    <h3 style="text-align: left; ">實務上既有系統容器化有5種類型的坑：</h3>
                    <p>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7">0.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="6">app要跟著轉變，時間會說明一切</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">(Microservice)</span></small>
                        </div>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7 ">1.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="1">設裡面設外面</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">
                                 (Isolation)
                                 </span></small>
                        </div>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7 ">2.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="2">過個水變權<del>(貴)</del>限</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">
                                    (Boundary)
                                </span></small>
                        </div>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7 ">3.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="3">網路卡無極限</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">
                                (Networking)</span></small>
                        </div>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7 ">4.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="4">Infra自幹有點累</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">
                                    (OS API/Service)</span></small>
                        </div>
                        <div style="text-align: left; padding: 5px">
                            <label class="fragment fade-up " data-fragment-index="7 ">5.&nbsp;</label><span class="fragment fade-up "
                                data-fragment-index="5">根本不是code的罪</span>
                            <small style="font-family: Sans-serif;font-size: 70%;text-transform: uppercase;" class="fragment fade-up" data-fragment-index="8">
                                <span class="fragment highlight-green" data-fragment-index="8">
                                    (Environment)</small>
                        </div>
                    </p>
                    <h4 class="fragment fade-up " data-fragment-index="9">其他無法歸類的坑也很多......</h4>
                </section>
                <section>
                    <h4>設裡面設外面<small class="fragment fade-up" data-fragment-index="5">
                        <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="5">&nbsp;(Isolation)</span></small></h4>
                    <div style="text-align: left;">
                        <ul class="fa">
                            <li class="fa">
                                <ul class="fa fa-ul">
                                    <li class="fa">
                                        <i class="fa fa-li fa-question" aria-hidden="true"></i>Config&nbsp;<code>/etc/hosts</code>&nbsp;mapping&nbsp;dns&nbsp;name&nbsp;to&nbsp;IP:<br/><small>
                                            <a href="http://community.linuxmint.com/tutorial/view/159" target="_blank">http://community.linuxmint.com/tutorial/view/159</a></small>
                                    </li>
                                    <li class="fa">
                                        <i class="fa fa-li fa-arrow-circle-right" aria-hidden="true"></i> 設在容器
                                        <span class="fragment fade-up" data-fragment-index="1">『<strong>裡面</strong>』的/etc/hosts檔</span>
                                    </li>
                                </ul>
                            </li>
                            <div style="font-size: 50%"><br/></div>
                            <li class="fa">
                                <ul class="fa fa-ul">
                                    <li class="fa">
                                        <i class="fa fa-li fa-question" aria-hidden="true"></i> Redis Linux kernel overcommit
                                        memory setting:<br/>
                                        <small>
                                            <a href="http://redis.io/topics/admin" target="_blank">Add vm.overcommit_memory = 1 to /etc/sysctl.conf and then reboot or run the command <code>sysctl vm.overcommit_memory=1</code></a>
                                        </small>
                                    </li>
                                    <li class="fa">
                                        <i class="fa fa-li fa-arrow-circle-right" aria-hidden="true"></i> 設在容器
                                        <span class="fragment fade-up" data-fragment-index="2">『<strong>外面</strong>』跑docker-engine的Host環境</span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <hr class="fragment fade-up" data-fragment-index="3" />
                        <span class="fragment fade-up" data-fragment-index="3"><i class="fa fa-lightbulb-o" aria-hidden="true"></i>
設定是應用程式本身的？<br/>
<i class="fa fa-lightbulb-o" aria-hidden="true"></i>
設定給執行環境(OS)的？<br/>
<i class="fa fa-lightbulb-o" aria-hidden="true"></i>
容器化的隔離技術是怎麼實現的？？<small style="font-family: Sans-serif;font-size: 80%" class="fragment fade-up" data-fragment-index="4"><bold>(該K的底層功課逃不了)</bold></small></span>
                    </div>
                </section>
                <section>
                    <h4>過個水變權
                        <del>(貴)</del>限<small class="fragment fade-up" data-fragment-index="5">
                            <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="5">&nbsp;(Boundary)</span></small></h4>
                    <ul class="fa fa-ul">
                        <li class="fa"><span class="fragment fade-up" data-fragment-index="1" style="white-space: nowrap">
                            <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                            Docker預設跑在容器內的使用者權限是<strong>【Root】</strong>!</span>
                        </li>
                        <br/>
                        <li class="fa">
                            <span class="fragment fade-up" data-fragment-index="2">
                                <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
                            容器內的程式假如寫入到volume mapping對應的主機檔案，原本的檔案權限都亂掉了~</span>
                        </li>
                    </ul>
                    <hr class="fragment fade-up" data-fragment-index="3" />
                    <p style="font-size: 75%;text-align: left;" class="fragment fade-up" data-fragment-index="3">
                        <ul class="fa fa-ul fragment fade-up" data-fragment-index="3">
                            <li class="fa"><i class="fa fa-li fa-circle-o-notch" aria-hidden="true"></i><span style="font-weight: bold">Workaround</span>：手動在啟動容器時額外塞外部的$UID、$GID環境變數，然後容器內最後要多做指令：<br/>
                                <code style="font-size: 75%"><a href="http://www.cyberciti.biz/faq/how-to-use-chmod-and-chown-command/" target="_blank">chown -R ${UID}:${GID}</a></code><br/>把權限
                                <span style="font-style: italic">橋</span>回來。</span>
                            </li>
                            <div style="font-size: 50%">&nbsp;</div>
                            <li class="fa"><i class="fa fa-li fa-check-circle" aria-hidden="true"></i>
                                <span style="font-weight: bold">正解</span>：資安角度強烈建議運營環境的docker容器內不要用預設執行權限!<br/>使用v1.10之後的
                                <a href="http://success.docker.com/Datacenter/Apply/Introduction_to_User_Namespaces_in_Docker_Engine" target="_blank">User Namespace mapping</a>功能。</li>
                        </ul>
                    </p>
                </section>
                <section>
                    <h4>網路卡無極限<small class="fragment fade-up" data-fragment-index="5">
                        <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="5">&nbsp;(Networking)</span></small>
                    </h4>
                    <div style="text-align: left;">
                        <ul class="fa fa-ul">
                            <li class="fa">
                                <ul class="fa fa-ul">
                                    <li class="fa"><span class="fragment fade-up" data-fragment-index="1">
                                        <i class="fa fa-li fa-info-circle" aria-hidden="true"></i>
                            Docker容器最簡單可供外界存取服務的配置方式：<br/>透過<span style="white-space: nowrap">port mapping</span>對應到Host主機特定埠上</span>
                                    </li>
                                    <li class="fa">
                                        <span class="fragment fade-up" data-fragment-index="2">
                                <i class="fa fa-li fa-exclamation-circle" aria-hidden="true"></i>
                            某些較早Linux Kernel版本(Ubuntu 12.04)且安裝多張網卡的環境，非預設路由網卡進來的連線會無法存取對應容器mapping port的服務。</span>
                                    </li>
                                </ul>
                            </li>
                            <div style="font-size: 50%">&nbsp;</div>
                            <ul class="fa fa-ul">
                                <li class="fa">
                                    <span class="fragment fade-up" data-fragment-index="3">
                                <i class="fa fa-li fa-exclamation-circle" aria-hidden="true"></i>
                                容器內應用服務listening [address:port]的設定寫成IPv6格式，在安裝太古早網卡硬體的hosting環境下服務會無法正常啟動。</span>
                                </li>
                            </ul>
                        </ul>

                        <hr class="fragment fade-up" data-fragment-index="4" />
                        <span class="fragment fade-up" data-fragment-index="4">
                            &nbsp;&nbsp;<i class="fa fa-angle-double-right"></i>
                            <i class="fa fa-angle-double-right"></i>
                            無解，人品不好就不要用太舊的軟硬體跑Docker&#x1f635;</span>
                    </div>
                </section>
                <section>
                    <h4>Infra自幹有點累<small class="fragment fade-up" data-fragment-index="5">
                        <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="5">&nbsp;(OS API/Service)</span></small>
                    </h4>
                    <div>
                        <p class="fragment fade-up" data-fragment-index="0">
                            Docker容器內的應用需要用到原本倚賴的作業系統服務<br/>(例：Unix/Linux的<a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html"
                                target="_blank">crontab</a>排程)<br/>怎麼辦？
                        </p>
                        <span class="fragment fade-up" data-fragment-index="1">自幹一個！&#x1f4aa;</span>
                        <ul class="fa fa-ul">
                            <li style="text-align: left;" class="fa fragment fade-up" data-fragment-index="2">
                                docker-crontab:<br/><a href="https://github.com/windperson/docker-crontab" target="_blank">http://github.com/windperson/docker-crontab</a>
                            </li>
                            <li style="text-align: left;" class="fa fragment fade-up" data-fragment-index="2">
                                prebuild docker image:<br/>
                                <a href="http://hub.docker.com/r/windperson/docker-crontab/" target="_blank">http://hub.docker.com/r/windperson/docker-crontab/</a>
                            </li>
                        </ul>
                        <hr class="fragment fade-up" data-fragment-index="3" />
                        <p class="fragment fade-up" data-fragment-index="3"><i class="fa fa-check-circle" aria-hidden="true"></i>當然更好的解法是程式改寫成使用其他外部服務</p>
                    </div>
                </section>
                <section>
                    <h4>根本不是code的罪<small class="fragment fade-up" data-fragment-index="7">
                        <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="7">&nbsp;(Environment)</span></small>
                    </h4>
                    <ol>
                        <li class="fragment fade-up" data-fragment-index="1">Docker storage bug:
                            <ul class="fa fa-ul">
                                <li class="fa fragment fade-up" data-fragment-index="2">
                                    <i class="fa fa-li fa-bug" aria-hidden="true"></i>Python pip install get failed on
                                    <a style="font-family: Sans-serif;" href="http://docs.docker.com/engine/userguide/storagedriver/overlayfs-driver/" target="_blank">OverlayFS</a>:<br/>
                                    <a href="http://github.com/pypa/pip/issues/2953" target="_blank">http://github.com/pypa/pip/issues/2953</a>
                                    <a href="http://github.com/docker/docker/issues/12327" target="_blank">http://github.com/docker/docker/issues/12327</a>
                                </li>
                                <li class="fa fragment fade-up" data-fragment-index="3">
                                    <i class="fa fa-li fa-bug" aria-hidden="true"></i>The same problem when using Linux "<code><a href="http://linuxcommand.org/man_pages/tar1.html" target="_blank">tar</a></code>"
                                    command:
                                    <br/>
                                    <a href="http://github.com/docker/docker/issues/19647" target="_blank">http://github.com/docker/docker/issues/19647</a>
                                </li>
                            </ul>
                        </li>
                        <div style="font-size: 30%;">&nbsp;</div>
                        <li class="fragment fade-up" data-fragment-index="4">Hosting environment bug:
                            <ul class="fa fa-ul">
                                <li class="fa fragment fade-up" data-fragment-index="5">
                                    <i class="fa fa-li fa-bug" aria-hidden="true"></i>
                                    <a href="https://github.com/docker-library/docs/tree/master/mongo#where-to-store-data" target="_blank">MongoDB  data directory on VirtualBox will lost when  container restart</a>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <hr class="fragment fade-up" data-fragment-index="6" />
                    <span style="white-space: nowrap;" class="fragment fade-up" data-fragment-index="6">
                        <i class="fa fa-cogs" aria-hidden="true"></i>&nbsp;使用的<strong><em>工具</em></strong>&nbsp;&&nbsp;<strong><em>環境</em></strong>&nbsp;&nbsp;複合因素造成的地雷還不少......</span>
                </section>
                <section>
                    <h4>app要跟著轉變，時間會說明一切<small class="fragment fade-up" data-fragment-index="7">
                        <span style="font-family: Sans-serif;font-size: 100%;text-transform: uppercase;" class="fragment highlight-green" data-fragment-index="7">&nbsp;(Microservice)</span></small>
                    </h4>
                    <div style="text-align: left; font-size: 90%">
                        <ul class="fa">
                            <li class="fa fragment fade-up" data-fragment-index="1">
                                <i class="fa fa-li fa-level-up" aria-hidden="true"></i><strong>共通功能統一標準化</strong><br/>Process
                                Manager&nbsp;+&nbsp;
                                <code><a href="" target="_blank">tail</a></code>指令的workaround轉為使用
                                <a href="http://docs.docker.com/engine/admin/logging/etwlogs/" target="_blank">ETW</a>、
                                <a href="http://docs.docker.com/engine/admin/logging/fluentd/" target="_blank">Fluentd</a>、
                                <a href="http://docs.docker.com/engine/admin/logging/journald" target="_blank">Journald</a>、
                                <a href="http://docs.docker.com/engine/admin/logging/splunk/" target="_blank">Splunk</a>等以便簡化容器的Log處理。<br/>
                                <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>可參考<a href="http://www.loggly.com/blog/top-5-docker-logging-methods-to-fit-your-container-deployment-strategy/"
                                    target="_blank">5 Docker Logging Methods</a>建議的5種配置。<br/>
                                <span class="fragment highlight-current-red" data-fragment-index="2">
                                    <span class="fragment highlight-red" data-fragment-index="2">
                                    <span class="fragment zoom-in" data-fragment-index="2">
                                    <i class="fa fa-exclamation"></i>
                                    <i class="fa fa-exclamation"></i>
                                    <i class="fa fa-exclamation"></i>
                                    容器內服務跑久了自己掛掉的bug最難找
                                    <i class="fa fa-exclamation"></i>
                                    <i class="fa fa-exclamation"></i>
                                    <i class="fa fa-exclamation"></i>
                                </span>
                                </span>
                                </span>
                            </li>
                            <div style="font-size: 30%;">&nbsp;</div>
                            <li class="fa fragment fade-up" data-fragment-index="3">
                                <i class="fa fa-li fa-level-up" aria-hidden="true"></i><strong class="fragement highlight-green"
                                    data-fragment-index="3">微服務化<small style="font-size: 80%;font-family: Sans-serif"><a href="http://blog.codeship.com/monolithic-core-vs-fully-microservice-architecture/" target="_blank">(Microservice architecture with a monolithic core)</small></a></strong><br/>
                                <span class="fragment fade-up" data-fragment-index="4">
                                    <ul class="fa fa-ul">
                                        <li class="fa">
                                        <i class="fa fa-li fa-wrench" aria-hidden="true"></i>
                                        用<a href="http://tuhrig.de/layering-of-docker-images/" target="_blank">Docker&nbsp;Image&nbsp;Layer</a>&nbsp;&&nbsp; 
                                        <a href="http://medium.com/@ramangupta/why-docker-data-containers-are-good-589b3c6c749e#.1aonow36p" target="_blank">data&nbsp;volume&nbsp;container&nbsp;</a>的技巧拆分<span style="white-space: no-wrap">原本monolithic架構。</span>
                            </li>
                            <li class="fa fragment fade-up" data-fragment-index="5">
                                <i class="fa fa-li fa-wrench" aria-hidden="true"></i> 為了讓包裝好的應用服務Image有足夠彈性，使用容器啟動時呼叫特定shell&nbsp;script，執行依環境變數配合範本引擎動態產生固定設定檔案的動作，最後再啟動服務的方式設計。
                            </li>
                            <li class="fa fragment fade-up" data-fragment-index="6">
                                <i class="fa fa-li fa-wrench" aria-hidden="true"></i>使用&nbsp;<a href="http://martinfowler.com/articles/injection.html"
                                    target="_blank">DI架構</a>&nbsp;的程式會較容易遷移至容器內&微服務化。
                            </li>
                        </ul>
                        </span>
                        </li>
                        </ul>
                    </div>
                </section>
            </section>
            <section>
                <section>
                    <h2>
                        實際範例Demo
                    </h2>
                </section>
            </section>
            <section>
                <h2>結論</h2>
                <section>
                    <div style="display position: absolute; top: 0px; text-align:center;" class="fragment fade-up" data-fragment-index="0">
                        <div style="height: auto;vertical-align: middle;" class="fragment fade-out" data-fragment-index="2">
                            <h4><br/>很想說的是：</h4>
                            <div class="fragment fade-up" data-fragment-index="1">
                                <img style="border: 0px; width:100%;" class="stretch" data-src="./pic/cowbae.png" />
                            </div>
                        </div>
                    </div>
                    <div style="display: block; position: absolute; top: 30px; text-align: center;" class="fragment fade-up" data-fragment-index="3">
                        <div class="fragment fade-out" data-fragment-index="7">
                            <h4><br/>但要說的是：
                                <span style="text-size:87%;white-space:nowrap; text-transform: capitalize;">
                                    <span class="fragment fade-up" data-fragment-index="4">Concept</span>
                                <span class="fragment fade-up" data-fragment-index="5">&nbsp;<i class="fa fa-long-arrow-right" aria-hidden="true"></i>&nbsp;&nbsp;Idea&nbsp;</span>
                                <span class="fragment fade-up" data-fragment-index="6">&nbsp;<i class="fa fa-long-arrow-right" aria-hidden="true"></i>&nbsp;&nbsp;Technique</span>
                                </span>
                            </h4>
                            <div style="display: table; table-layout: fixed; width:100%; overflow:auto; height: auto;vertical-align: middle;">
                                <img style="border: 0px;" class="stretch" data-src="./pic/kamen_rider_FOURZE_03.png" /><br/>
                                <small>來源：<a href="https://ja.wikipedia.org/wiki/仮面ライダーフォーゼ#.E6.94.BE.E9.80.81.E6.97.A5.E7.A8.8B" target="_blank">仮面ライダーフォーゼ</a>&nbsp;episode&nbsp;3</small>
                            </div>
                        </div>
                    </div>
                    <div style="display: block; position: absolute; top: 30px; text-align: center;" class="fragment fade-up" data-fragment-index="8">
                        <div style="text-align: left;">
                            <br/>
                            <h4><span>&nbsp;&nbsp;&nbsp;</span>只是別這樣：</h4>
                        </div>
                        <div style="display: table; table-layout: fixed; width:100%; overflow:auto;">
                            <div style="display: table-cell; width: 60%; height: auto;vertical-align: middle;">
                                <img style="border: 0px; width: auto;  height: 100%; " data-src="./pic/1520.gif" /><br/>
                                <small>來源：<a href="http://eznewlife.com/animation_photos/1520.gif" target="_blank">http://eznewlife.com/animation_photos/1520.gif</a></small>
                            </div>
                            <div style="display: table-cell; vertical-align: middle;" class="fragment fade-up" data-fragment-index="9">
                                <h4 style="font-family: Sans-serif;font-size: 120%;white-space: nowrap;text-transform: uppercase;">Do it Right!<br/>Thank you~</h4>
                            </div>
                        </div>
                </section>
                <section>
                    <div style="position: relative; text-align: left;">
                        <h3>
                            <div>投影片</div>
                            <div style="padding: 22px;">
                                <ul class="fa fa-ul">
                                    <li class="fa"><i class="fa fa-li fa-cloud" aria-hidden="true"></i><span style="font-family: serif;text-transform: lowercase;">線上看：<a href="http://bit.ly/2cl5cgT" target="_blank">http://bit.ly/2cl5cgT</a></span></li>
                                    <br/>
                                    <li class="fa"><i class="fa fa-li fa-github" aria-hidden="true"></i><span style="font-family: serif;text-transform: lowercase;">原始碼：<a href="http://bit.ly/2cXZHTs"
                                        target="_blank">http://bit.ly/2cXZHTs</a></span></li>
                                </ul><br/>
                            </div>
                        </h3>
                        <h3>
                            <div>範例程式</div>
                            <div style="padding: 22px;">
                                <ul class="fa fa-ul">
                                    <li class="fa"><i class="fa fa-li fa-github" aria-hidden="true"></i><span style="font-family: serif;text-transform: lowercase;">原始碼：<a href="http://bit.ly/2cUSIfi"
                                        target="_blank">http://bit.ly/2cUSIfi</a></span></li>
                                </ul>
                            </div>
                        </h3>
                        <hr class="fragment fade-up" data-fragment-index="1" />
                        <div class="fragment fade-up" data-fragment-index="2" style="z-index: 1;position: absolute; float: right; right:33px; font-size: 87%;text-align: left;">
                            關於我<span style="padding-left: 22px;">
                        <ul class="fa fa-ul">
                            <li class="fa"><i class="fa fa-li fa-facebook-square" aria-hidden="true"></i><a style="font-family: Sans-serif;" href="https://www.facebook.com/windperson" target="_blank">Facebook</a></li>
                            <br/>
                            <li class="fa"><i class="fa fa-li fa-google-plus-square" aria-hidden="true"></i><a style="font-family: Sans-serif;"  href="https://plus.google.com/+ChenYuPao" target="_blank">Google+</a></li>
                            <br/>
                            <li class="fa"><i class="fa fa-li fa-linkedin-square" aria-hidden="true"></i><a style="font-family: Sans-serif;"  href="http://www.linkedin.com/in/isakpao" target="_blank">Linkedin</a></li>                           
                        </ul>
                        </span>
                        </div>
                    </div>
                </section>
            </section>
            <section>
                <section>
                    <h2>參考資料</h2>
                </section>
                <section>
                    <h3>常用docker&nbsp;&&nbsp;docker-compose指令</h3>
                    <pre>
                        <code class="hljs">
#List all container(running or not running):
docker ps -a

#Run container(it will download image -> create container -> run it):
docker run image_name [command to run in container]

#Start a  stopped state container:
docker start [container_ID|container_Name]

#Check container detail information(include virtual IP address):
docker inspect [container_ID|container_Name]

#Get container's IP address:
docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' [container_ID|container_Name]

#See container's information filter by certain "JSON node":
docker inspect --format='{{json .[JSON_node_name]}}' [container_ID|container_Name]

#Console into running container:
docker exec -it [container_ID|container_Name] bash

#When using docker-compose, this is create new container and run with command:
docker-compose [-f the_yml_file] run yml_defined_service_name bash

#See container's running log:
docker logs [container_ID|container_Name]

#Save container version:
docker commit [container_ID|container_Name] The_name_you_want

#Stop running container:
docker stop

#Show current docker daemon's images:
docker images

#Remove all containers:
docker rm -f $(docker ps -aq)

#Remove all images currently in host:
docker rmi -f $(docker images -aq)

#Remove all volumes in current host:
docker volume rm $(docker volume ls -q)

#Remove all untagged images (images has &lt;none&gt; in REPOSITORY field as example):
docker rmi $(docker images -q -f=dangling=true)
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>redis容器設定的demo</h3>
                    <small><a href="./redis_config.html" target="_blank">另開新頁</a></small>
                    <iframe class="stretch" data-src="./redis_config.html"></iframe>
                    <small>會發現居然kernel設定是要設在跑docker-engine的Host上，redis有個啟動warning才會消失<br/>&#x1f631;</small>
                </section>
                <section>
                    <h3>使用Process Manager + tail指令</h3>
                    <ul class="fa fa-ul" style="font-size: 80%">
                        <li class="fa">
                            <i class="fa fa-li fa-wrench" aria-hidden="true"></i>用來把原本程式行為是<code style="font-style: italic;">Hard&nbsp;Code</code>寫入到固定位置檔案的log，導入到docker-engine的預設log機制裡。</li>
                        <div style="font-size: 20%">&nbsp;</div>
                        <li class="fa"><i class="fa fa-li fa-exclamation" aria-hidden="true"></i> 設定時要注意
                            <a href="https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/" target="_blank">Pid&nbsp;1問題</a>，以免docker容器會停下來要非常久。
                        </li>
                        <div style="font-size: 20%">&nbsp;</div>
                        <li class="fa"><i class="fa fa-li fa-file-code-o" aria-hidden="true"></i> 以下用Python的process&nbsp;manager:&nbsp;
                            <a href="https://pypi.python.org/pypi/circus" target="_blank">circus</a>&nbsp;的設定範例：
                        </li>
                    </ul>
                    <pre style="padding: 0; margin-top: 0;">
                        <code data-trim data-noescape class="hljs ini">
[watcher:show_log_worker]
cmd = <mark>/usr/bin/tail --retry -f /php_log/access.log --retry -f /php_log/exception.log --retry -f /php_log/error.log --retry -f /php_log/slow.log</mark>
copy_env = True
stdout_stream.class = StdoutStream
stderr_stream.class = StdoutStream

[watcher:phpfpm_worker]
cmd = /usr/local/sbin/php-fpm
working_dir=/var/www/html
numprocesses = 1
warmup_delay = 3
graceful_timeout = 10
copy_env = True
stdout_stream.class = StdoutStream
stderr_stream.class = StdoutStream
                        </code>
                    </pre>
                </section>
            </section>
            </div>
            </div>
            <script src="lib/js/head.min.js "></script>
            <script src="js/reveal.js "></script>

            <script>
		// Required, even if empty.
		Reveal.initialize({
            // Enable slide navigation via mouse wheel
            mouseWheel: false,
            // Push each slide change to the browser history
            history: true,
            // Display the page number of the current slide
            slideNumber: true,
            // Hides the address bar on mobile devices
            hideAddressBar: true,
            slideNumber: 'c/t',
            dependencies: [
                { src: 'plugin/chalkboard/chalkboard.js', async: true },
                { src: 'plugin/zoom-js/zoom.js', async: true },
                { src: '//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js', 
                async: true, callback: function() { 
                    hljs.initHighlightingOnLoad(); 
                }}
            ],
                
            chalkboard: {
                src: './annotation.json',
                readOnly: undefined,
                // readOnly: false,
                transition: 1000, 
                toggleChalkboardButton: false,
                color: [ 'rgba(255,0,0,1)', 'rgba(255,255,255,0.5)' ]
            },
            keyboard: {
                67: function() { RevealChalkboard.toggleNotesCanvas() },    // toggle notes canvas when 'c' is pressed
                // 68: function() { RevealChalkboard.download() }, // downlad recorded chalkboard drawing when 'd' is pressed
                45: function() { RevealChalkboard.reset() },    // reset chalkboard data on current slide when '-' is pressed
                46: function() { RevealChalkboard.clear() }    // clear chalkboard when 'DEL' is pressed
            }
		});

        if( window.location.search.match( /print-pdf/gi ) ) {
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = 'css/print/pdf.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        }
	</script>
</body>

</html>